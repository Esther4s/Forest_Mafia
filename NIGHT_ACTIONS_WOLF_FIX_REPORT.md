# üê∫ –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º—ã —Å –Ω–æ—á–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –≤–æ–ª–∫–∞

## üö® –ü—Ä–æ–±–ª–µ–º–∞
–í–æ–ª–∫ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –Ω–æ—á—å - –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—ã–±—Ä–∞—Ç—å "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥" –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞ "‚ùå –ù–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!"

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã
**–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞**: `night_actions` –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –∏–ª–∏ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –º–æ–º–µ–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback'–∞ –≤–æ–ª–∫–∞.

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. `bot_instance` –º–æ–∂–µ—Ç –±—ã—Ç—å `None` (–ø—Ä–æ–±–ª–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏)
2. `game.chat_id` –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ `bot_instance.night_actions`
3. `night_actions` –º–æ–≥—É—Ç –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏ –Ω–∞—á–∞–ª–µ –∏–≥—Ä—ã
4. –ü—Ä–æ–±–ª–µ–º–∞ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –º–µ–∂–¥—É —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏–≥—Ä—ã –∏ –Ω–æ—á–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (callback_handler.py)
**–§–∞–π–ª**: `callback_handler.py`, –º–µ—Ç–æ–¥ `_handle_wolf_action`
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```python
# –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ö–æ–¥–∞ –≤–æ–ª–∫–∞
self.logger.info(f"üîç –ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥–∞ –≤–æ–ª–∫–∞ –¥–ª—è –∏–≥—Ä—ã {game.chat_id}")
self.logger.info(f"üîç bot_instance: {bot_instance is not None}")
if bot_instance:
    self.logger.info(f"üîç night_actions: {list(bot_instance.night_actions.keys())}")
    self.logger.info(f"üîç game.chat_id –≤ night_actions: {game.chat_id in bot_instance.night_actions}")
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ night_actions (callback_handler.py)
**–§–∞–π–ª**: `callback_handler.py`, –º–µ—Ç–æ–¥—ã `_handle_wolf_action`
**–†–µ—à–µ–Ω–∏–µ**: –ï—Å–ª–∏ `night_actions` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –æ–Ω–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

```python
# –ü–æ–ø—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å night_actions –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
if bot_instance and game.chat_id not in bot_instance.night_actions:
    self.logger.warning(f"‚ö†Ô∏è night_actions –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–ª—è —á–∞—Ç–∞ {game.chat_id}, —Å–æ–∑–¥–∞–µ–º...")
    try:
        from night_actions import NightActions
        from night_interface import NightInterface
        
        bot_instance.night_actions[game.chat_id] = NightActions(game)
        bot_instance.night_interfaces[game.chat_id] = NightInterface(game, bot_instance.night_actions[game.chat_id], bot_instance.get_display_name)
        
        self.logger.info(f"‚úÖ –°–æ–∑–¥–∞–Ω—ã night_actions –¥–ª—è —á–∞—Ç–∞ {game.chat_id}")
        
        # –¢–µ–ø–µ—Ä—å –ø—Ä–æ–±—É–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
        night_actions = bot_instance.night_actions[game.chat_id]
        success = night_actions.skip_action(user_id)  # –∏–ª–∏ set_wolf_target
```

### 3. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
**–§–∞–π–ª**: `callback_handler.py`
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

```python
except Exception as e:
    self.logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è night_actions: {e}")
    await query.answer("‚ùå –ù–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!", show_alert=True)
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ night_actions** - –µ—Å–ª–∏ –æ–Ω–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞ –ª–µ—Ç—É
2. **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ç–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–µ–π—Å—Ç–≤–∏–π –≤–æ–ª–∫–∞
3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
4. **–†–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º** - –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π

### üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –í–æ–ª–∫ –Ω–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥" –∏–ª–∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ `night_actions` –¥–ª—è —á–∞—Ç–∞
3. –ï—Å–ª–∏ `night_actions` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç - —Å–æ–∑–¥–∞–µ—Ç –∏—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. –í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (–ø—Ä–æ–ø—É—Å–∫ –∏–ª–∏ –≤—ã–±–æ—Ä —Ü–µ–ª–∏)
5. –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- ‚úÖ –í–æ–ª–∫ –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –Ω–æ—á—å
- ‚úÖ –í–æ–ª–∫ –º–æ–∂–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å —Ü–µ–ª–∏
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

## üöÄ –°—Ç–∞—Ç—É—Å
**–ò–°–ü–†–ê–í–õ–ï–ù–û** - –ü—Ä–æ–±–ª–µ–º–∞ —Å –Ω–æ—á–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –≤–æ–ª–∫–∞ —Ä–µ—à–µ–Ω–∞ —á–µ—Ä–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ `night_actions` –∏ —É–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `bot.py` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∏—è `night_actions`
- –£–ª—É—á—à–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –±–æ—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–æ—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–µ—Ä–µ–¥ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
