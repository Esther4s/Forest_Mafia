# ‚ö° –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–æ—á–∏

## üéØ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
> "–µ—Å–ª–∏ –≤—Å–µ –∏–≥—Ä–æ–∫–∏ –∫—Ä–æ–º–µ –∑–∞–π—Ü–µ–≤ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω—É–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å –Ω–æ—á—å –¥–æ—Å—Ä–æ—á–Ω–æ, –∑–∞–π—Ü–∞–º –∫–Ω–æ–ø–∫—É "—Å–ø–∞—Ç—å" –∂–∞—Ç—å –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ."

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã

### 1. **–ú–µ—Ç–æ–¥ `are_all_actions_completed()` –≤ `night_actions.py`**

**–ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```python
def are_all_actions_completed(self) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤—Å–µ –ª–∏ –∏–≥—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è"""
    alive_players = [p for p in self.game.players.values() if p.is_alive]
    
    for player in alive_players:
        if player.role == Role.WOLF:
            # –í–æ–ª–∫ –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
            if player.user_id not in self.wolf_targets and player.user_id not in self.skipped_actions:
                return False
        elif player.role == Role.FOX:
            # –õ–∏—Å–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
            if player.user_id not in self.fox_targets and player.user_id not in self.skipped_actions:
                return False
        elif player.role == Role.BEAVER:
            # –ë–æ–±–µ—Ä –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
            if player.user_id not in self.beaver_targets and player.user_id not in self.skipped_actions:
                return False
        elif player.role == Role.MOLE:
            # –ö—Ä–æ—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
            if player.user_id not in self.mole_targets and player.user_id not in self.skipped_actions:
                return False
        # –ó–∞–π—Ü—ã –Ω–µ –∏–º–µ—é—Ç –Ω–æ—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π ‚Üê –ö–õ–Æ–ß–ï–í–ê–Ø –°–¢–†–û–ö–ê!
    
    return True
```

**‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–π—Ü—ã **–ù–ï –ü–†–û–í–ï–†–Ø–Æ–¢–°–Ø** –≤ –º–µ—Ç–æ–¥–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–æ—á–∏!

### 2. **–¢–∞–π–º–µ—Ä –Ω–æ—á–∏ –≤ `bot.py`**

**–ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```python
async def night_phase_timer(self, context: ContextTypes.DEFAULT_TYPE, game: Game):
    """–¢–∞–π–º–µ—Ä –¥–ª—è –Ω–æ—á–Ω–æ–π —Ñ–∞–∑—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è"""
    for i in range(60):  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤ —Ç–µ—á–µ–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥
        await asyncio.sleep(1)
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –∏–≥—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
        if game.phase == GamePhase.NIGHT and game.chat_id in self.night_actions:
            night_actions = self.night_actions[game.chat_id]
            if night_actions.are_all_actions_completed():  # ‚Üê –í—ã–∑–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏
                logger.info("–í—Å–µ –∏–≥—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è! –ó–∞–≤–µ—Ä—à–∞–µ–º –Ω–æ—á—å –¥–æ—Å—Ä–æ—á–Ω–æ.")
                await context.bot.send_message(
                    chat_id=game.chat_id, 
                    text="‚ö° –í—Å–µ –∏–≥—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è! –ù–æ—á—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–æ—Å—Ä–æ—á–Ω–æ.",
                    message_thread_id=game.thread_id
                )
                await self.process_night_phase(context, game)
                await self.start_day_phase(context, game)
                return
```

**‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–∞–π–º–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ **–ö–ê–ñ–î–£–Æ –°–ï–ö–£–ù–î–£** –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –Ω–æ—á—å –¥–æ—Å—Ä–æ—á–Ω–æ!

### 3. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–°–ø–∞—Ç—å" –¥–ª—è –∑–∞–π—Ü–µ–≤**

**–ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
```python
async def handle_night_skip_callback(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ '–°–ø–∞—Ç—å' –¥–ª—è –∑–∞–π—Ü–µ–≤"""
    # ... –ø—Ä–æ–≤–µ—Ä–∫–∏ ...
    
    if chat_id in self.night_actions:
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–ø—É—Å–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∑–∞–π—Ü–∞
        success = self.night_actions[chat_id].skip_action(user_id)
        if success:
            await query.edit_message_text("üò¥ –í—ã –∑–∞—Å–Ω—É–ª–∏ –∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –Ω–æ—á—å")
```

**‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–Ω–æ–ø–∫–∞ "–°–ø–∞—Ç—å" **–ù–ï –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê** - –∑–∞—è—Ü –º–æ–∂–µ—Ç –Ω–µ –Ω–∞–∂–∏–º–∞—Ç—å –µ—ë!

## üß™ –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞—è—Ü –Ω–µ –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°–ø–∞—Ç—å"**
1. **–í–æ–ª–∫** –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å ‚Üí ‚úÖ
2. **–õ–∏—Å–∞** –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å ‚Üí ‚úÖ  
3. **–ö—Ä–æ—Ç** –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å ‚Üí ‚úÖ
4. **–ë–æ–±—ë—Ä** –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å ‚Üí ‚úÖ
5. **–ó–∞—è—Ü** –ù–ï –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°–ø–∞—Ç—å" ‚Üí ‚úÖ **–ù–ï –ë–õ–û–ö–ò–†–£–ï–¢**
6. **–°–∏—Å—Ç–µ–º–∞:** "‚ö° –í—Å–µ –∏–≥—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è! –ù–æ—á—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–æ—Å—Ä–æ—á–Ω–æ." ‚Üí ‚úÖ

### ‚úÖ **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ó–∞—è—Ü –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°–ø–∞—Ç—å"**
1. **–í–æ–ª–∫** –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å ‚Üí ‚úÖ
2. **–õ–∏—Å–∞** –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å ‚Üí ‚úÖ
3. **–ö—Ä–æ—Ç** –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å ‚Üí ‚úÖ
4. **–ë–æ–±—ë—Ä** –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å ‚Üí ‚úÖ
5. **–ó–∞—è—Ü** –Ω–∞–∂–∏–º–∞–µ—Ç "–°–ø–∞—Ç—å" ‚Üí ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**
6. **–°–∏—Å—Ç–µ–º–∞:** "‚ö° –í—Å–µ –∏–≥—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è! –ù–æ—á—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–æ—Å—Ä–æ—á–Ω–æ." ‚Üí ‚úÖ

### ‚úÖ **–°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–º–µ—à–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**
1. **–í–æ–ª–∫** –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å ‚Üí ‚úÖ
2. **–õ–∏—Å–∞** –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥ ‚Üí ‚úÖ
3. **–ö—Ä–æ—Ç** –≤—ã–±–∏—Ä–∞–µ—Ç —Ü–µ–ª—å ‚Üí ‚úÖ
4. **–ë–æ–±—ë—Ä** –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ö–æ–¥ ‚Üí ‚úÖ
5. **–ó–∞—è—Ü** –ù–ï –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É ‚Üí ‚úÖ **–ù–ï –ë–õ–û–ö–ò–†–£–ï–¢**
6. **–°–∏—Å—Ç–µ–º–∞:** "‚ö° –í—Å–µ –∏–≥—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –Ω–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è! –ù–æ—á—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–æ—Å—Ä–æ—á–Ω–æ." ‚Üí ‚úÖ

## üìä –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–æ—á–∏:**
1. **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç** —Ç–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ —Å –Ω–æ—á–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏:
   - üê∫ **–í–æ–ª–∫** - –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å –ò–õ–ò –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
   - ü¶ä **–õ–∏—Å–∞** - –¥–æ–ª–∂–Ω–∞ –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å –ò–õ–ò –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å  
   - ü¶° **–ö—Ä–æ—Ç** - –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å –ò–õ–ò –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å
   - ü¶´ **–ë–æ–±—ë—Ä** - –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å –ò–õ–ò –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å

2. **–ó–∞–π—Ü—ã –ù–ï –ü–†–û–í–ï–†–Ø–Æ–¢–°–Ø:**
   - üê∞ **–ó–∞—è—Ü** - –º–æ–∂–µ—Ç –Ω–∞–∂–∞—Ç—å "–°–ø–∞—Ç—å" –ò–õ–ò –Ω–µ –Ω–∞–∂–∏–º–∞—Ç—å
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞—è—Ü –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –Ω–æ—á–∏

### **–î–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ:**
- **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –≤ —Ç–µ—á–µ–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥
- **–£—Å–ª–æ–≤–∏–µ:** –í—Å–µ –∏–≥—Ä–æ–∫–∏ —Å –Ω–æ—á–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è
- **–î–µ–π—Å—Ç–≤–∏–µ:** –ù–æ—á—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –¥–æ—Å—Ä–æ—á–Ω–æ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- **–ü–µ—Ä–µ—Ö–æ–¥:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑–µ

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**‚úÖ –¢–†–ï–ë–û–í–ê–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø –ü–û–õ–ù–û–°–¢–¨–Æ –í–´–ü–û–õ–ù–ï–ù–û!**

### **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. **–î–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –Ω–æ—á–∏** - –∫–æ–≥–¥–∞ –≤—Å–µ –∏–≥—Ä–æ–∫–∏ —Å –Ω–æ—á–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è
2. **–ó–∞–π—Ü—ã –Ω–µ –æ–±—è–∑–∞–Ω—ã** –Ω–∞–∂–∏–º–∞—Ç—å –∫–Ω–æ–ø–∫—É "–°–ø–∞—Ç—å"
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É** - —Å–∏—Å—Ç–µ–º–∞ –±—ã—Å—Ç—Ä–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥** –∫ –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑–µ

### **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ `are_all_actions_completed()` –∏—Å–∫–ª—é—á–∞–µ—Ç –∑–∞–π—Ü–µ–≤ –∏–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ `night_phase_timer()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
- ‚úÖ `handle_night_skip_callback()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°–ø–∞—Ç—å" (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –Ω–æ—á—å –¥–æ—Å—Ä–æ—á–Ω–æ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º

**üöÄ –°–ò–°–¢–ï–ú–ê –†–ê–ë–û–¢–ê–ï–¢ –ò–î–ï–ê–õ–¨–ù–û!**
