# üí∞üõçÔ∏è –î–û–ë–ê–í–õ–ï–ù–ò–ï –ö–û–ú–ê–ù–î /BALANCE –ò /SHOP –í –ë–´–°–¢–†–´–ô –î–û–°–¢–£–ü

## üéØ **–ó–ê–î–ê–ß–ê**

–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã `/balance` –∏ `/shop` –≤ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –º–µ–Ω—é –±–æ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–±—ã—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏.

---

## ‚úÖ **–í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø**

### **1. –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /shop**

**–§–∞–π–ª:** `bot.py`

**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥:**
```python
async def shop_command(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä–æ–≤"""
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    has_permission, error_msg = await self.check_user_permissions(update, context, "member")
    if not has_permission:
        await self.send_permission_error(update, context, error_msg)
        return
        
    user_id = update.effective_user.id
    username = update.effective_user.username or update.effective_user.first_name or "Unknown"
    
    try:
        if not self.db:
            await update.message.reply_text("‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
            return
        
        logger.info(f"üõçÔ∏è –ó–∞–ø—Ä–æ—Å –º–∞–≥–∞–∑–∏–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {username} (ID: {user_id})")
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞
        shop_items = get_shop_items()
        
        if not shop_items:
            await update.message.reply_text("üõçÔ∏è **–ú–∞–≥–∞–∑–∏–Ω –ø—É—Å—Ç**\n\n–¢–æ–≤–∞—Ä—ã –ø–æ—è–≤—è—Ç—Å—è –ø–æ–∑–∂–µ!")
            return
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–æ–≤–∞—Ä–∞–º–∏
        shop_text = "üõçÔ∏è **–ú–∞–≥–∞–∑–∏–Ω ForestMafia**\n\n"
        shop_text += "üí∞ **–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã:**\n\n"
        
        for item in shop_items:
            shop_text += f"**{item['id']}.** {item['item_name']}\n"
            shop_text += f"   üí∞ –¶–µ–Ω–∞: {item['price']} –æ—Ä–µ—à–∫–æ–≤\n"
            shop_text += f"   üìù {item['description']}\n\n"
        
        shop_text += "üí° **–ö–∞–∫ –∫—É–ø–∏—Ç—å:**\n"
        shop_text += "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /buy <–Ω–æ–º–µ—Ä_—Ç–æ–≤–∞—Ä–∞>\n"
        shop_text += "–ù–∞–ø—Ä–∏–º–µ—Ä: /buy 1\n\n"
        shop_text += "üå∞ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å: /balance"
        
        await update.message.reply_text(shop_text)
            
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞: {e}")
        import traceback
        logger.error(f"‚ùå Traceback: {traceback.format_exc()}")
        await update.message.reply_text("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
```

### **2. –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã –≤ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø**

**–§–∞–π–ª:** `bot.py` - –º–µ—Ç–æ–¥ `setup_bot_commands`

**–î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã:**
```python
commands = [
    # üéÆ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
    BotCommand("start", "üå≤ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç"),
    BotCommand("join", "‚úÖ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ"),
    BotCommand("status", "üìä –°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã"),
    BotCommand("help", "üÜò –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"),
    BotCommand("rules", "üìñ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã"),
    BotCommand("balance", "üí∞ –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å"),      # ‚Üê –ù–û–í–ê–Ø –ö–û–ú–ê–ù–î–ê
    BotCommand("shop", "üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä–æ–≤"),        # ‚Üê –ù–û–í–ê–Ø –ö–û–ú–ê–ù–î–ê
    
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
]
```

### **3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥**

**–§–∞–π–ª:** `bot.py` - –º–µ—Ç–æ–¥ `run`

**–î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
```python
# –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
application.add_handler(CommandHandler("balance", self.balance_command)) # –ö–æ–º–∞–Ω–¥–∞ /balance
application.add_handler(CommandHandler("shop", self.shop_command))       # –ö–æ–º–∞–Ω–¥–∞ /shop
application.add_handler(CommandHandler("game", self.game_command))       # –ö–æ–º–∞–Ω–¥–∞ /game
```

### **4. –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏ get_shop_items**

**–§–∞–π–ª:** `bot.py` - –∏–º–ø–æ—Ä—Ç—ã

**–î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç:**
```python
from database_psycopg2 import (
    # ... –¥—Ä—É–≥–∏–µ –∏–º–ø–æ—Ä—Ç—ã
    add_nuts_to_user, get_shop_items  # ‚Üê –ù–û–í–´–ô –ò–ú–ü–û–†–¢
)
```

---

## üß™ **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï**

### **–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test_commands_simple.py`**

**–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:**
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `setup_bot_commands`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ú–µ—Ç–æ–¥—ã `balance_command` –∏ `shop_command` —Å—É—â–µ—Å—Ç–≤—É—é—Ç
- ‚úÖ –ò–º–ø–æ—Ä—Ç `get_shop_items` –¥–æ–±–∞–≤–ª–µ–Ω
- ‚úÖ –§—É–Ω–∫—Ü–∏—è `get_shop_items` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `balance_manager` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 3
- **–ü—Ä–æ–π–¥–µ–Ω–æ**: 3 (100%)
- **–ü—Ä–æ–≤–∞–ª–µ–Ω–æ**: 0 (0%)
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å**: 100%

---

## üéÆ **–§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨ –ö–û–ú–ê–ù–î**

### **–ö–æ–º–∞–Ω–¥–∞ /balance**
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –æ—Ä–µ—à–∫–∞—Ö
- **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –æ–±—ã—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
  - –ü–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –±–∞–ª–∞–Ω—Å–æ–º
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### **–ö–æ–º–∞–Ω–¥–∞ /shop**
- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä–æ–≤
- **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –æ–±—ã—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å —Ü–µ–Ω–∞–º–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ–∫—É–ø–∫–µ —Ç–æ–≤–∞—Ä–æ–≤
  - –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É /balance
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞–≥–∞–∑–∏–Ω
  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

## üì± **–ò–ù–¢–ï–†–§–ï–ô–° –ö–û–ú–ê–ù–î**

### **–ö–æ–º–∞–Ω–¥–∞ /balance:**
```
üå∞ –ë–∞–ª–∞–Ω—Å –∏–≥—Ä–æ–∫–∞ test_user:

üí≥ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: 150.0 –æ—Ä–µ—à–∫–æ–≤

üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /join —á—Ç–æ–±—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ!
```

### **–ö–æ–º–∞–Ω–¥–∞ /shop:**
```
üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω ForestMafia

üí∞ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã:

1. üé≠ –ú–∞—Å–∫–∞ –≤–æ–ª–∫–∞
   üí∞ –¶–µ–Ω–∞: 100.0 –æ—Ä–µ—à–∫–æ–≤
   üìù –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –º–∞—Å–∫–∞ –¥–ª—è —Ä–æ–ª–∏ –≤–æ–ª–∫–∞

2. ü¶ä –•–≤–æ—Å—Ç –ª–∏—Å—ã
   üí∞ –¶–µ–Ω–∞: 150.0 –æ—Ä–µ—à–∫–æ–≤
   üìù –ü—É—à–∏—Å—Ç—ã–π —Ö–≤–æ—Å—Ç –ª–∏—Å—ã

üí° –ö–∞–∫ –∫—É–ø–∏—Ç—å:
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /buy <–Ω–æ–º–µ—Ä_—Ç–æ–≤–∞—Ä–∞>
–ù–∞–ø—Ä–∏–º–µ—Ä: /buy 1

üå∞ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å: /balance
```

---

## üîí **–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨**

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:**
- –û–±–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –¢—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤–∞ "member" (–æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –ø—Ä–∞–≤–∞—Ö

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

---

## üéâ **–†–ï–ó–£–õ–¨–¢–ê–¢**

### ‚úÖ **–ö–æ–º–∞–Ω–¥—ã —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã:**

- ‚úÖ `/balance` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `/shop` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–∞–≥–∞–∑–∏–Ω —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –±—ã—Å—Ç—Ä–æ–º –º–µ–Ω—é –±–æ—Ç–∞
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–±—ã—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- ‚úÖ –ö—Ä–∞—Å–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —ç–º–æ–¥–∑–∏ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ:**

- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ–¥
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã

**–ö–æ–º–∞–Ω–¥—ã /balance –∏ /shop —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø!** üöÄ

---

## üìÅ **–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**

1. `test_commands_simple.py` - –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –∫–æ–º–∞–Ω–¥
2. `BALANCE_SHOP_COMMANDS_REPORT.md` - –æ—Ç—á–µ—Ç –æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥

---

**–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è**: 9 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: ‚úÖ –ü–†–û–ô–î–ï–ù–û
