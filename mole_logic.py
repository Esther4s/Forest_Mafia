#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
–õ–æ–≥–∏–∫–∞ —Ä–æ–ª–∏ –ö—Ä–æ—Ç (–∞–Ω–∞–ª–æ–≥ –®–µ—Ä–∏—Ñ–∞) –≤ –∏–≥—Ä–µ "–õ–µ—Å –∏ –í–æ–ª–∫–∏"
"""

from typing import Optional
from game_logic import Player, Role


class Mole:
    """
    –ö–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–∏–∫–∏ —Ä–æ–ª–∏ –ö—Ä–æ—Ç
    –ö—Ä–æ—Ç –º–æ–∂–µ—Ç —Ä–∞–∑ –≤ –Ω–æ—á—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ—Ä–∫—É –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∏ —É–∑–Ω–∞—Ç—å –µ–≥–æ —Ä–æ–ª—å
    """
    
    @staticmethod
    def check_player(target: Player, current_round: int) -> str:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–≥—Ä–æ–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
        
        Args:
            target: –¶–µ–ª–µ–≤–æ–π –∏–≥—Ä–æ–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            current_round: –¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥ –∏–≥—Ä—ã
            
        Returns:
            str: –°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏
        """
        if not target or not target.is_alive:
            return "ü¶° –ö—Ä–æ—Ç –∑–∞–≥–ª—è–Ω—É–ª –≤ –Ω–æ—Ä–∫—É, –Ω–æ –æ–Ω–∞ –æ–∫–∞–∑–∞–ª–∞—Å—å –ø—É—Å—Ç–æ–π..."
        
        # –ü–æ–ª—É—á–∞–µ–º —Ä—É—Å—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏
        role_names = {
            Role.WOLF: "–í–æ–ª–∫",
            Role.FOX: "–õ–∏—Å–∞", 
            Role.HARE: "–ó–∞—è—Ü",
            Role.MOLE: "–ö—Ä–æ—Ç",
            Role.BEAVER: "–ë–æ–±—ë—Ä"
        }
        role_name = role_names.get(target.role, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ")
        
        # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–∫–ª–æ–Ω–µ–Ω–∏–µ –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∞–¥–µ–∂–∞
        role_genitive = {
            Role.WOLF: "–≤–æ–ª–∫–∞",
            Role.FOX: "–ª–∏—Å—ã", 
            Role.HARE: "–∑–∞–π—Ü–∞",
            Role.MOLE: "–∫—Ä–æ—Ç–∞",
            Role.BEAVER: "–±–æ–±—Ä–∞"
        }
        role_genitive_name = role_genitive.get(target.role, "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–µ–π—Å—Ç–≤–æ–≤–∞–ª –ª–∏ –∏–≥—Ä–æ–∫ –≤ —ç—Ç—É –Ω–æ—á—å
        last_action_round = getattr(target, "last_action_round", 0)
        is_active_this_night = last_action_round == current_round
        
        # –õ–æ–≥–∏–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π
        if target.role == Role.WOLF:
            if is_active_this_night:
                # –í–æ–ª–∫ –≤—ã—à–µ–ª –Ω–∞ –æ—Ö–æ—Ç—É
                return "ü¶° –ö—Ä–æ—Ç –∑–∞–≥–ª—è–Ω—É–ª –≤ –Ω–æ—Ä–∫—É, –Ω–æ –æ–Ω–∞ –±—ã–ª–∞ –ø—É—Å—Ç–∞. –ü–æ—Ö–æ–∂–µ, —Ö–æ–∑—è–∏–Ω –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –Ω–∞ –æ—Ö–æ—Ç—É..."
            else:
                # –í–æ–ª–∫ –¥–æ–º–∞
                return "ü¶° –ö—Ä–æ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ–ª –∏–∑-–ø–æ–¥ —Ç–∏—à–∫–∞ –∏ –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ —ç—Ç–æ –í–æ–ª–∫!"
        
        elif target.role == Role.FOX:
            if is_active_this_night:
                # –õ–∏—Å–∞ –≤–æ—Ä–æ–≤–∞–ª–∞
                return f"ü¶° –ö—Ä–æ—Ç –∑–∞–≥–ª—è–Ω—É–ª –≤ –Ω–æ—Ä–∫—É, –Ω–æ –æ–Ω–∞ –±—ã–ª–∞ –ø—É—Å—Ç–∞. –ü–æ—Ö–æ–∂–µ, {role_name} –æ—Ç–ø—Ä–∞–≤–∏–ª–∞—Å—å –Ω–∞ –¥–µ–ª–æ..."
            else:
                # –õ–∏—Å–∞ –¥–æ–º–∞
                return f"ü¶° –ö—Ä–æ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ–ª –∏–∑-–ø–æ–¥ —Ç–∏—à–∫–∞ –∏ –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ —ç—Ç–æ {role_name}!"
        
        elif target.role == Role.HARE:
            if is_active_this_night:
                # –ó–∞—è—Ü —á—Ç–æ-—Ç–æ –¥–µ–ª–∞–ª (—Ä–µ–¥–∫–æ, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ)
                return f"ü¶° –ö—Ä–æ—Ç –∑–∞–≥–ª—è–Ω—É–ª –≤ –Ω–æ—Ä–∫—É, –Ω–æ –æ–Ω–∞ –±—ã–ª–∞ –ø—É—Å—Ç–∞. –ü–æ—Ö–æ–∂–µ, {role_name} –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –ø–æ –¥–µ–ª–∞–º..."
            else:
                # –ó–∞—è—Ü –¥–æ–º–∞
                return f"ü¶° –ö—Ä–æ—Ç –ø—Ä–∏—à—ë–ª –∫ –Ω–æ—Ä–∫–µ {role_genitive_name}, —Ç–æ—Ç –µ–º—É –æ—Ç–∫—Ä—ã–ª –¥–≤–µ—Ä—å. –í—Å—ë —Å–ø–æ–∫–æ–π–Ω–æ, –æ–Ω –º–∏—Ä–Ω—ã–π."
        
        elif target.role == Role.BEAVER:
            if is_active_this_night:
                # –ë–æ–±—ë—Ä –ø–æ–º–æ–≥–∞–ª
                return f"ü¶° –ö—Ä–æ—Ç –∑–∞–≥–ª—è–Ω—É–ª –≤ –Ω–æ—Ä–∫—É, –Ω–æ –æ–Ω–∞ –±—ã–ª–∞ –ø—É—Å—Ç–∞. –ü–æ—Ö–æ–∂–µ, {role_name} –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –ø–æ–º–æ–≥–∞—Ç—å..."
            else:
                # –ë–æ–±—ë—Ä –¥–æ–º–∞
                return f"ü¶° –ö—Ä–æ—Ç –ø—Ä–∏—à—ë–ª –∫ –Ω–æ—Ä–∫–µ {role_genitive_name}, —Ç–æ—Ç –µ–º—É –æ—Ç–∫—Ä—ã–ª –¥–≤–µ—Ä—å. –í—Å—ë —Å–ø–æ–∫–æ–π–Ω–æ, –æ–Ω –º–∏—Ä–Ω—ã–π."
        
        elif target.role == Role.MOLE:
            if is_active_this_night:
                # –î—Ä—É–≥–æ–π –∫—Ä–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–ª
                return f"ü¶° –ö—Ä–æ—Ç –∑–∞–≥–ª—è–Ω—É–ª –≤ –Ω–æ—Ä–∫—É, –Ω–æ –æ–Ω–∞ –±—ã–ª–∞ –ø—É—Å—Ç–∞. –ü–æ—Ö–æ–∂–µ, {role_name} –æ—Ç–ø—Ä–∞–≤–∏–ª—Å—è –Ω–∞ —Ä–∞–∑–≤–µ–¥–∫—É..."
            else:
                # –î—Ä—É–≥–æ–π –∫—Ä–æ—Ç –¥–æ–º–∞
                return f"ü¶° –ö—Ä–æ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ–ª –∏–∑-–ø–æ–¥ —Ç–∏—à–∫–∞ –∏ –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ —ç—Ç–æ {role_name}!"
        
        else:
            # –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å
            return "ü¶° –ö—Ä–æ—Ç –∑–∞–≥–ª—è–Ω—É–ª –≤ –Ω–æ—Ä–∫—É, –Ω–æ –Ω–µ —Å–º–æ–≥ –ø–æ–Ω—è—Ç—å, –∫—Ç–æ –∑–¥–µ—Å—å –∂–∏–≤—ë—Ç..."
    
    @staticmethod
    def get_role_hint(target: Player, current_round: int) -> str:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É –æ —Ä–æ–ª–∏ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –∫—Ä–æ—Ç–∞
        
        Args:
            target: –¶–µ–ª–µ–≤–æ–π –∏–≥—Ä–æ–∫
            current_round: –¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥
            
        Returns:
            str: –ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ —Ä–æ–ª–∏
        """
        if not target or not target.is_alive:
            return "–ú—ë—Ä—Ç–≤—ã–π –∏–≥—Ä–æ–∫"
        
        last_action_round = getattr(target, "last_action_round", 0)
        is_active_this_night = last_action_round == current_round
        
        if target.role == Role.WOLF:
            if is_active_this_night:
                return "–í–æ–ª–∫ (–Ω–∞ –æ—Ö–æ—Ç–µ)"
            else:
                return "–í–æ–ª–∫ (–¥–æ–º–∞)"
        
        elif target.role == Role.FOX:
            if is_active_this_night:
                return "–õ–∏—Å–∞ (–≤–æ—Ä—É–µ—Ç)"
            else:
                return "–õ–∏—Å–∞ (–¥–æ–º–∞)"
        
        elif target.role == Role.HARE:
            if is_active_this_night:
                return "–ó–∞—è—Ü (–∞–∫—Ç–∏–≤–µ–Ω)"
            else:
                return "–ó–∞—è—Ü (–º–∏—Ä–Ω—ã–π)"
        
        elif target.role == Role.BEAVER:
            if is_active_this_night:
                return "–ë–æ–±—ë—Ä (–ø–æ–º–æ–≥–∞–µ—Ç)"
            else:
                return "–ë–æ–±—ë—Ä (–º–∏—Ä–Ω—ã–π)"
        
        elif target.role == Role.MOLE:
            if is_active_this_night:
                return "–ö—Ä–æ—Ç (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç)"
            else:
                return "–ö—Ä–æ—Ç (–¥–æ–º–∞)"
        
        else:
            return "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —Ä–æ–ª—å"


