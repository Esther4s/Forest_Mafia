# –û—Ç—á–µ—Ç –æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —ç—Ç–∞–ø–æ–≤

## üéØ –¶–µ–ª—å
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –∏–≥—Ä—ã (–¥–µ–Ω—å, –Ω–æ—á—å, –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ) —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏–µ–º –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É.

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ Game
- **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ**: `stage_pinned_messages` - —Å–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- **–î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã**:
  - `set_stage_pinned_message(stage, message_id)` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ID –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  - `get_stage_pinned_message(stage)` - –ø–æ–ª—É—á–µ–Ω–∏–µ ID –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  - `clear_stage_pinned_message(stage)` - –æ—á–∏—Å—Ç–∫–∞ ID –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —ç—Ç–∞–ø–∞
  - `clear_all_stage_pinned_messages()` - –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö ID —ç—Ç–∞–ø–æ–≤

### 2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ ForestWolvesBot
- **–î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã**:
  - `_pin_stage_message(context, game, stage, message_id)` - –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —ç—Ç–∞–ø–∞
  - `_unpin_previous_stage_message(context, game, current_stage)` - –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —ç—Ç–∞–ø–∞
- **–û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥**: `_unpin_all_bot_messages()` - —Ç–µ–ø–µ—Ä—å –æ—Ç–∫—Ä–µ–ø–ª—è–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–≥—Ä—ã

### 3. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ –Ω–∞—á–∞–ª–∞ —ç—Ç–∞–ø–æ–≤

#### `start_night_phase()`
- –ó–∞–∫—Ä–µ–ø–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –Ω–æ—á–∏
- –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö update, —Ç–∞–∫ –∏ –¥–ª—è callback query

#### `start_day_phase()`
- –û—Ç–∫—Ä–µ–ø–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–æ—á–∏
- –ó–∞–∫—Ä–µ–ø–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –¥–Ω—è

#### `start_voting_phase()`
- –û—Ç–∫—Ä–µ–ø–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–Ω—è
- –ó–∞–∫—Ä–µ–ø–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è

#### `start_new_night()`
- –û—Ç–∫—Ä–µ–ø–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –Ω–æ–≤–æ–π –Ω–æ—á–∏

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü–æ—Ä—è–¥–æ–∫ —ç—Ç–∞–ø–æ–≤
1. **–ù–æ—á—å** ‚Üí **–î–µ–Ω—å** ‚Üí **–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ** ‚Üí **–ù–æ—á—å** (—Ü–∏–∫–ª)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ–º
- –ü—Ä–∏ –Ω–∞—á–∞–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É –æ—Ç–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —ç—Ç–∞–ø–∞
- –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–≥—Ä—ã –æ—Ç–∫—Ä–µ–ø–ª—è—é—Ç—Å—è –≤—Å–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è/–æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏—è –æ–±–µ—Ä–Ω—É—Ç—ã –≤ try-catch –±–ª–æ–∫–∏
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
- Graceful degradation - –µ—Å–ª–∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –∏–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç—ã:
1. **`test_stage_pinning.py`** - –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
2. **`test_stage_pinning_integration.py`** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:
- ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ ID —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (–æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∏ –≤—Å–µ—Ö)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ–∞–∑–∞–º–∏ –∏–≥—Ä—ã
- ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
- ‚úÖ –¶–∏–∫–ª—ã –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è-–æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏—è

## üìã –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. **–ù–∞—á–∞–ª–æ –Ω–æ—á–∏**: –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "üåô –ù–∞—Å—Ç—É–ø–∞–µ—Ç –Ω–æ—á—å..."
2. **–ù–∞—á–∞–ª–æ –¥–Ω—è**: –æ—Ç–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–æ—á–∏, –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "‚òÄÔ∏è –ù–∞—Å—Ç—É–ø–∏–ª–æ —É—Ç—Ä–æ..."
3. **–ù–∞—á–∞–ª–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è**: –æ—Ç–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–Ω—è, –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "üó≥Ô∏è –ö–æ–≥–æ –∂–µ –º—ã –∏–∑–≥–æ–Ω–∏–º..."
4. **–ù–æ–≤–∞—è –Ω–æ—á—å**: –æ—Ç–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è, –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–æ—á–∏
5. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã**: –æ—Ç–∫—Ä–µ–ø–ª—è—é—Ç—Å—è –≤—Å–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- üéØ –ò–≥—Ä–æ–∫–∏ –≤—Å–µ–≥–¥–∞ –≤–∏–¥—è—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —ç—Ç–∞–ø –∏–≥—Ä—ã
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- üõ°Ô∏è –ù–∞–¥–µ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- üì± –£–ª—É—á—à–µ–Ω–Ω—ã–π UX –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
- üßπ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∏–≥—Ä—ã

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:
```python
game.stage_pinned_messages = {
    "night": 12345,
    "day": 67890,
    "voting": 11111
}
```

### –ü–æ—Ä—è–¥–æ–∫ —ç—Ç–∞–ø–æ–≤:
```python
stage_order = ["night", "day", "voting"]
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è/–æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º WARNING
- –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º INFO

## ‚úÖ –°—Ç–∞—Ç—É—Å
**–†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û** - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.
