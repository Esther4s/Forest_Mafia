# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ CallbackQuery –∏ —Ç–µ–≥–æ–≤

## ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´:**

### 1Ô∏è‚É£ **–û—à–∏–±–∫–∞ CallbackQuery –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ":**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ `query` –≤–º–µ—Å—Ç–æ `update` –≤ `check_game_permissions`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ"
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "üê∫ –í—ã–±—Ä–∞—Ç—å –≤–æ–ª–∫–∞"
- ‚úÖ –¢–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

### 2Ô∏è‚É£ **–¢–µ–≥–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã:**
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–µ–≥–∞–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–µ–∑ parse_mode
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- ‚úÖ –¢–µ–≥–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ

---

## üîç **–î–ï–¢–ê–õ–ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:**

### **–û—à–∏–±–∫–∞ CallbackQuery:**
```python
# –†–∞–Ω—å—à–µ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
has_permission, error_msg = await self.check_game_permissions(query, context, "day_end_discussion")

# –¢–µ–ø–µ—Ä—å (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
has_permission, error_msg = await self.check_game_permissions(update, context, "day_end_discussion")
```

### **–¢–µ–≥–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:**
```python
# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–≥–∞–º–∏
try:
    if hasattr(update, 'message') and update.message:
        await update.message.reply_text(tag_message, parse_mode='Markdown')
    else:
        await context.bot.send_message(
            chat_id=game.chat_id,
            text=tag_message,
            parse_mode='Markdown',
            message_thread_id=game.thread_id
        )
except Exception as send_error:
    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–µ–≥–∞–º–∏: {send_error}")
    # –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–µ–∑ parse_mode
    try:
        await context.bot.send_message(
            chat_id=game.chat_id,
            text=tag_message,
            message_thread_id=game.thread_id
        )
    except Exception as fallback_error:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–µ–≥–∞–º–∏ (fallback): {fallback_error}")
```

---

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:**

### ‚úÖ **–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**
- **–ö–Ω–æ–ø–∫–∏ "–ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ" –∏ "–í—ã–±—Ä–∞—Ç—å –≤–æ–ª–∫–∞"** —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- **–¢–µ–≥–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤** –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã
- **–û—à–∏–±–∫–∏ CallbackQuery** –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ–º–æ–∂–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ–≥–∞–º–∏

### ‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∑–∞–≤–µ—Ä—à–∞—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –≤—ã–±–∏—Ä–∞—Ç—å –≤–æ–ª–∫–∞
- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∫—Ä–∞—Å–∏–≤—ã–µ —Ç–µ–≥–∏ –≤ –ª–µ—Å–Ω–æ–º —Å—Ç–∏–ª–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

---

## üöÄ **–î–ï–ü–õ–û–ô:**

### 1Ô∏è‚É£ **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã –∫ –¥–µ–ø–ª–æ—é:**
- –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–¥
- –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- –ì–æ—Ç–æ–≤–æ –∫ –∫–æ–º–º–∏—Ç—É –∏ –ø—É—à—É

### 2Ô∏è‚É£ **–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**
- Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –±–æ—Ç–∞
- –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å—Ç—É–ø—è—Ç –≤ —Å–∏–ª—É
- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ

---

## üéâ **–ì–û–¢–û–í–û!**

**–û—à–∏–±–∫–∏ CallbackQuery –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, —Ç–µ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç!** üöÇüå≤

---
*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ CallbackQuery –∏ —Ç–µ–≥–æ–≤*
