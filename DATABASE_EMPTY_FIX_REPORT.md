# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—É—Å—Ç–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

## ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞:**
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞, —Ö–æ—Ç—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –µ—Å—Ç—å. –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–≥—Ä.

## üîç **–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**

### 1Ô∏è‚É£ **–û—à–∏–±–∫–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø–æ –∏–≥—Ä–æ–∫–∞–º:**
- –í `start_game` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `game.players` –≤–º–µ—Å—Ç–æ `game.players.values()`
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–æ–≤ –≤ –ë–î

### 2Ô∏è‚É£ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ù–µ –±—ã–ª–æ –≤–∏–¥–Ω–æ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- –°–ª–æ–∂–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

---

## ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í–´–ü–û–õ–ù–ï–ù–´:**

### 1Ô∏è‚É£ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –∏–≥—Ä–æ–∫–∞–º:**
```python
# –†–∞–Ω—å—à–µ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
for player in game.players:
    self.db.add_player(...)

# –¢–µ–ø–µ—Ä—å (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
for player in game.players.values():
    self.db.add_player(...)
```

### 2Ô∏è‚É£ **–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å rollback

### 3Ô∏è‚É£ **–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:**
- ‚úÖ `check_database.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä –∏ –∏–≥—Ä–æ–∫–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü

---

## üîç **–î–ï–¢–ê–õ–ò –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô:**

### **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏:**
```python
# –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –≤ –ë–î
for player in game.players.values():  # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: .values()
    self.db.add_player(
        db_game_id, 
        player.user_id, 
        player.username, 
        player.first_name, 
        player.last_name
    )

# –ù–∞–∑–Ω–∞—á–∞–µ–º —Ä–æ–ª–∏ –≤ –ë–î
role_assignments = {}
for player in game.players.values():  # –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: .values()
    role_assignments[player.user_id] = {
        "role": player.role.value if player.role else None,
        "team": player.team.value if player.team else None
    }
```

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ DatabaseManager:**
```python
def __init__(self, database_url: Optional[str] = None):
    print(f"üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: {database_url}")
    self.engine = create_engine(database_url, echo=False)
    self.SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=self.engine)
    
    # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—ã
    try:
        Base.metadata.create_all(bind=self.engine)
        print("‚úÖ –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü: {e}")
        raise
```

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ GameService:**
```python
@staticmethod
def create_game(chat_id: int, thread_id: Optional[int] = None, settings: Dict[str, Any] = None) -> Game:
    session = get_db_session()
    try:
        print(f"üéÆ –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã –¥–ª—è —á–∞—Ç–∞ {chat_id}, —Ç–µ–º–∞ {thread_id}")
        game = Game(chat_id=chat_id, thread_id=thread_id, settings=settings or {})
        session.add(game)
        session.commit()
        session.refresh(game)
        print(f"‚úÖ –ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ —Å ID: {game.id}")
        return game
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–≥—Ä—ã: {e}")
        session.rollback()
        raise
    finally:
        session.close()
```

---

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢:**

### ‚úÖ **–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**
- **–ò–≥—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- **–ò–≥—Ä–æ–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è** –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ–º–æ–∂–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
- **–°–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î

### ‚úÖ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
- –í –ª–æ–≥–∞—Ö Railway –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
- –í –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤
- –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å `check_database.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üöÄ **–î–ï–ü–õ–û–ô:**

### 1Ô∏è‚É£ **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã –∫ –¥–µ–ø–ª–æ—é:**
- –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–¥
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ë–î

### 2Ô∏è‚É£ **–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**
- Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –±–æ—Ç–∞
- –í –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ –±–∞–∑—É

---

## üéâ **–ì–û–¢–û–í–û!**

**–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—É—Å—Ç–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞!** üöÇüå≤

**–¢–µ–ø–µ—Ä—å –∏–≥—Ä—ã –∏ –∏–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ PostgreSQL!** ‚úÖ

---
*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—É—Å—Ç–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö*
