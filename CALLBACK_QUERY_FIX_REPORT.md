# üîß –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –û–®–ò–ë–ö–ò CALLBACK QUERY

## üìã –û–±–∑–æ—Ä

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 6 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–®–ò–ë–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ê –£–°–ü–ï–®–ù–û

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

**‚ùå –û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö:**
```
AttributeError: 'Update' object has no attribute 'from_user'
AttributeError: 'Update' object has no attribute 'answer'
```

**üîç –ü—Ä–∏—á–∏–Ω–∞:**
- –í –º–µ—Ç–æ–¥–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä `query` –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –≤ `check_user_permissions`
- `check_user_permissions` –æ–∂–∏–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç `Update`, –Ω–æ –ø–æ–ª—É—á–∞–ª `CallbackQuery`
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞—Ç—Ä–∏–±—É—Ç–∞–º

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### üîß **1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `handle_cancel_game_callback`:**

#### **–ë—ã–ª–æ:**
```python
async def handle_cancel_game_callback(self, query, context: ContextTypes.DEFAULT_TYPE):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã)
    has_permission, error_msg = await self.check_user_permissions(
        query, context, "admin"  # ‚ùå query - —ç—Ç–æ CallbackQuery, –∞ –Ω–µ Update
    )
```

#### **–°—Ç–∞–ª–æ:**
```python
async def handle_cancel_game_callback(self, query, context: ContextTypes.DEFAULT_TYPE):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã)
    # –°–æ–∑–¥–∞–µ–º Update –æ–±—ä–µ–∫—Ç –∏–∑ CallbackQuery
    update = Update(update_id=0, callback_query=query)
    has_permission, error_msg = await self.check_user_permissions(
        update, context, "admin"  # ‚úÖ update - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Update –æ–±—ä–µ–∫—Ç
    )
```

### üîß **2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

#### **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `handle_vote` - —Å–æ–∑–¥–∞–Ω–∏–µ Update –∏–∑ CallbackQuery
- `handle_night_action` - —Å–æ–∑–¥–∞–Ω–∏–µ Update –∏–∑ CallbackQuery
- `handle_wolf_voting` - —Å–æ–∑–¥–∞–Ω–∏–µ Update –∏–∑ CallbackQuery
- `handle_join_game_callback` - —Å–æ–∑–¥–∞–Ω–∏–µ Update –∏–∑ CallbackQuery
- `handle_leave_registration_callback` - —Å–æ–∑–¥–∞–Ω–∏–µ Update –∏–∑ CallbackQuery
- `handle_view_my_role` - —Å–æ–∑–¥–∞–Ω–∏–µ Update –∏–∑ CallbackQuery

#### **–ü–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# –ë–´–õ–û:
has_permission, error_msg = await self.check_user_permissions(
    query, context, "member"
)

# –°–¢–ê–õ–û:
update = Update(update_id=0, callback_query=query)
has_permission, error_msg = await self.check_user_permissions(
    update, context, "member"
)
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### ‚úÖ **–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚ùå `AttributeError: 'Update' object has no attribute 'from_user'`
- ‚ùå `AttributeError: 'Update' object has no attribute 'answer'`
- ‚ùå –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### ‚úÖ **–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

## üõ°Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ Update –∏–∑ CallbackQuery:**
```python
update = Update(update_id=0, callback_query=query)
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- `Update` - –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç Telegram Bot API
- `CallbackQuery` - —á–∞—Å—Ç—å Update –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
- `update_id=0` - –≤—Ä–µ–º–µ–Ω–Ω—ã–π ID (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø—Ä–∞–≤)
- `callback_query=query` - –ø–µ—Ä–µ–¥–∞–µ–º CallbackQuery –≤ Update

### ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:**
```python
has_permission, error_msg = await self.check_user_permissions(
    update, context, "admin"
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `check_user_permissions` –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø `Update`
- –î–æ—Å—Ç—É–ø –∫ `update.effective_user` –∏ `update.effective_chat` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

## üéØ –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### üîß **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
1. **–û—Ç–º–µ–Ω–∞ –∏–≥—Ä—ã** - `handle_cancel_game_callback`
2. **–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ** - `handle_vote`
3. **–ù–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è** - `handle_night_action`
4. **–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –≤–æ–ª–∫–æ–≤** - `handle_wolf_voting`
5. **–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∏–≥—Ä–µ** - `handle_join_game_callback`
6. **–í—ã—Ö–æ–¥ –∏–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** - `handle_leave_registration_callback`
7. **–ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–æ–ª–∏** - `handle_view_my_role`

### üîß **–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤:**
- **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã** - –¥–ª—è –æ—Ç–º–µ–Ω—ã –∏–≥—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- **–£—á–∞—Å—Ç–Ω–∏–∫–∏** - –¥–ª—è –∏–≥—Ä–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- **–ë–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∞** - –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–∞:**
```bash
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 0 –æ—à–∏–±–æ–∫
read_lints bot.py
```

### ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤:**
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã
- `check_user_permissions` –ø–æ–ª—É—á–∞–µ—Ç `Update`
- Callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üèÜ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### ‚úÖ **–û–®–ò–ë–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ê –£–°–ü–ï–®–ù–û!**

1. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** - –≤—Å–µ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã
2. **‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ Update –æ–±—ä–µ–∫—Ç–æ–≤** - CallbackQuery –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ Update
3. **‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç** - `check_user_permissions` –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
4. **‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫** - –±–æ–ª—å—à–µ –Ω–µ—Ç AttributeError –≤ –ª–æ–≥–∞—Ö

### üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- **üîß –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –≤—Å–µ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- **üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- **üì± –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –±–æ—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
- **üéÆ –ò–≥—Ä–æ–≤–æ–π –æ–ø—ã—Ç** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ –∫–Ω–æ–ø–∫–∏

### üöÄ **–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞:**

- **‚úÖ –í—Å–µ callback-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** - —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞
- **‚úÖ –õ–∏–Ω—Ç–µ—Ä —á–∏—Å—Ç** - –∫–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º
- **‚úÖ –õ–æ–≥–∏ —á–∏—Å—Ç—ã–µ** - –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ —Ä–∞–±–æ—Ç–µ

---
**–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** 6 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–®–ò–ë–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ê –£–°–ü–ï–®–ù–û  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** ‚úÖ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ
