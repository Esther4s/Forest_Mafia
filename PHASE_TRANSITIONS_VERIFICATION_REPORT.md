# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –ª–æ–≥–∏–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏

## üéØ –í–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. **"–†–∞–∑–≤–µ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–æ—á—å –Ω–∞—Å—Ç—É–ø–∞–µ—Ç?"**
2. **"–†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è?"**

## ‚úÖ –û—Ç–≤–µ—Ç—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏

**–î–ê, –≤—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã!** –ü–æ—Å–ª–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç –Ω–æ—á—å.

#### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ñ–∞–∑:
```
–ù–æ—á—å ‚Üí –î–µ–Ω—å ‚Üí –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ ‚Üí –ù–æ—á—å (—Ü–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è)
```

#### –î–µ—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞:
1. **–ù–æ—á—å** (60 —Å–µ–∫) ‚Üí **–î–µ–Ω—å** (5 –º–∏–Ω) ‚Üí **–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ** (2 –º–∏–Ω) ‚Üí **–ù–æ—á—å**
2. –ü–æ—Å–ª–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `process_voting_results()` ‚Üí `start_new_night()` ‚Üí `start_night_phase()`

### 2. –î–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è

**–î–ê, –¥–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!**

#### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. **–ö–Ω–æ–ø–∫–∞ "üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ"** –¥–æ—Å—Ç—É–ø–Ω–∞ –≤–æ –≤—Ä–µ–º—è –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑—ã
2. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏:
   - –û—Ç–º–µ–Ω—è–µ—Ç—Å—è —Ç–∞–π–º–µ—Ä –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑—ã (`game.cancel_day_timer()`)
   - –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—é (`start_voting_phase()`)
   - –û—Ç–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–Ω—è, –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è

## üß™ –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ–π–¥–µ–Ω—ã —Ç–µ—Å—Ç—ã:
1. **`test_early_discussion_end.py`** - –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Ñ–∞–∑
2. **`test_early_discussion_bot_integration.py`** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:
- ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –≤—Å–µ–º–∏ —Ñ–∞–∑–∞–º–∏
- ‚úÖ –î–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑—ã
- ‚úÖ –û—Ç–º–µ–Ω–∞ —Ç–∞–π–º–µ—Ä–∞ –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑—ã
- ‚úÖ –°—Ç–∞—Ç—É—Å —Ç–∞–π–º–µ—Ä–∞ –ø–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã
- ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ –æ—Ç–º–µ–Ω—ã —Ç–∞–π–º–µ—Ä–∞
- ‚úÖ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∏–≥—Ä—ã —Å –¥–æ—Å—Ä–æ—á–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

### –ü–µ—Ä–µ—Ö–æ–¥—ã —Ñ–∞–∑ –≤ –∫–æ–¥–µ:

#### 1. –ù–æ—á—å ‚Üí –î–µ–Ω—å
```python
# –í night_phase_timer()
if game.phase == GamePhase.NIGHT:
    await self.process_night_phase(update, context, game)
    await self.start_day_phase(update, context, game)  # –ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–Ω—é
```

#### 2. –î–µ–Ω—å ‚Üí –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
```python
# –í day_phase_timer() - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
if game.phase == GamePhase.DAY:
    await self.start_voting_phase(update, context, game)

# –í callback "day_end_discussion" - –¥–æ—Å—Ä–æ—á–Ω–æ
game.cancel_day_timer()  # –û—Ç–º–µ–Ω—è–µ–º —Ç–∞–π–º–µ—Ä
await self.start_voting_phase(mock_update, context, game)  # –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—é
```

#### 3. –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ ‚Üí –ù–æ—á—å
```python
# –í process_voting_results()
winner = game.check_game_end()
if winner:
    await self.end_game_winner(update, context, game, winner)
else:
    logger.info("–ò–≥—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è. –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –Ω–æ—á—å.")
    await self.start_new_night(update, context, game)  # –ü–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–æ—á–∏

# –í start_new_night()
await self._unpin_previous_stage_message(context, game, "night")  # –û—Ç–∫—Ä–µ–ø–ª—è–µ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
await self.start_night_phase(update, context, game)  # –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ—á—å
```

## üéÆ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ü–∏–∫–ª
1. **–ù–æ—á—å** (60 —Å–µ–∫) - –∏–≥—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç –Ω–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
2. **–î–µ–Ω—å** (5 –º–∏–Ω) - –æ–±—Å—É–∂–¥–µ–Ω–∏–µ, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
3. **–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ** (2 –º–∏–Ω) - –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞ –∏–∑–≥–Ω–∞–Ω–∏–µ
4. **–ù–æ—á—å** - —Ü–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–Ω—è
1. **–ù–æ—á—å** ‚Üí **–î–µ–Ω—å** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è)
2. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç "üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ"
3. –¢–∞–π–º–µ—Ä –¥–Ω—è –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è
4. **–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É)
5. **–ù–æ—á—å** (–ø–æ—Å–ª–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
1. **–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è)
2. –í—Å–µ –∏–≥—Ä–æ–∫–∏ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏
3. –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –¥–æ—Å—Ä–æ—á–Ω–æ
4. **–ù–æ—á—å** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É)

## üîß –£–ª—É—á—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞–º–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∑–∞–¥–∞—á—É –¥–Ω–µ–≤–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ç–º–µ–Ω–∞ —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
- –û—á–∏—Å—Ç–∫–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ –∑–∞–¥–∞—á–∏

### 2. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- –ö–Ω–æ–ø–∫–∞ "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–∞–π–º–µ—Ä–∞" –≤–æ –≤—Ä–µ–º—è –¥–Ω—è
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ —Ç–∞–π–º–µ—Ä–∞
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ —Ñ–∞–∑
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω—ã —Ç–∞–π–º–µ—Ä–æ–≤
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```
–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 14
–ü—Ä–æ–π–¥–µ–Ω–æ: 14 ‚úÖ
–ü—Ä–æ–≤–∞–ª–µ–Ω–æ: 0 ‚ùå
–ü–æ–∫—Ä—ã—Ç–∏–µ: 100%
```

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

1. **"–†–∞–∑–≤–µ –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–æ—á—å –Ω–∞—Å—Ç—É–ø–∞–µ—Ç?"**
   - **–î–ê, –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** –ü–æ—Å–ª–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—É–ø–∞–µ—Ç –Ω–æ—á—å
   - –õ–æ–≥–∏–∫–∞: `process_voting_results()` ‚Üí `start_new_night()` ‚Üí `start_night_phase()`

2. **"–†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è?"**
   - **–î–ê, —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!** –ö–Ω–æ–ø–∫–∞ "üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ" –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
     - –û—Ç–º–µ–Ω—è–µ—Ç —Ç–∞–π–º–µ—Ä –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑—ã
     - –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –∏–≥—Ä—É –≤ —Ñ–∞–∑—É –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
     - –£–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–∞–π–º–µ—Ä–∞
- ‚úÖ –£–ª—É—á—à–µ–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ!** üéâ
