# üèÅ –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∫–Ω–æ–ø–∫–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –¥–Ω–µ–º

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

**–ö–Ω–æ–ø–∫–∞ "üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ" –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞** –≤ –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑–µ –∏–≥—Ä—ã.

## üîç –ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –º–µ—Ç–æ–¥–µ `handle_day_actions`**: –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `start_voting_phase` –∏ `start_wolf_voting_phase` –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç `update`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –æ—à–∏–±–∫–∞–º.

### –ö–æ–¥ –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```python
if query.data == "day_end_discussion":
    await query.edit_message_text("üèÅ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–≤–µ—Ä—à–∏–ª –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ä–æ—á–Ω–æ!")
    await self.start_voting_phase(update, context, game)  # ‚ùå update –º–æ–∂–µ—Ç –±—ã—Ç—å None –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ç–∏–ø–∞
```

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

**–°–æ–∑–¥–∞–Ω mock –æ–±—ä–µ–∫—Ç `update`** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –º–µ—Ç–æ–¥–æ–≤ `start_voting_phase` –∏ `start_wolf_voting_phase`.

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤ mock –æ–±—ä–µ–∫—Ç–µ - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `self` –≤ lambda —Ñ—É–Ω–∫—Ü–∏—é.

### –ö–æ–¥ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```python
if query.data == "day_end_discussion":
    if game.phase != GamePhase.DAY:
        await query.edit_message_text("‚ùå –°–µ–π—á–∞—Å –Ω–µ –≤—Ä–µ–º—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è!")
        return

    await query.edit_message_text("üèÅ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–≤–µ—Ä—à–∏–ª –æ–±—Å—É–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ä–æ—á–Ω–æ!")
    # –°–æ–∑–¥–∞–µ–º mock update –¥–ª—è start_voting_phase
    mock_update = type('MockUpdate', (), {
        'message': type('MockMessage', (), {
            'reply_text': lambda text, **kwargs: context.bot.send_message(
                chat_id=game.chat_id, 
                text=text, 
                message_thread_id=game.thread_id
            )
        })()
    })()
    await self.start_voting_phase(mock_update, context, game)
```

## üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### ‚úÖ –ö–Ω–æ–ø–∫–∏ –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑—ã:
- **"üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ"** (`day_end_discussion`) - —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- **"üê∫ –í—ã–±—Ä–∞—Ç—å –≤–æ–ª–∫–∞"** (`day_choose_wolf`) - —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

### ‚úÖ –ú–µ—Ç–æ–¥—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏:
- **`handle_day_actions`** - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –≤—ã–∑—ã–≤–∞–µ–º—ã–π ‚úÖ
- **`start_voting_phase`** - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –≤—ã–∑—ã–≤–∞–µ–º—ã–π ‚úÖ
- **`start_wolf_voting_phase`** - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –≤—ã–∑—ã–≤–∞–µ–º—ã–π ‚úÖ

### ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥—ã —Ñ–∞–∑:
- **WAITING ‚Üí NIGHT** - —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- **NIGHT ‚Üí DAY** - —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- **DAY ‚Üí VOTING** - —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

### ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback'–æ–≤:
- **`CallbackQueryHandler(pattern=r"^day_")`** - –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω ‚úÖ

## üéÆ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è

### 1. **–î–Ω–µ–≤–Ω–∞—è —Ñ–∞–∑–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è:**
- –ò–≥—Ä–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ñ–∞–∑—É `GamePhase.DAY`
- –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑–æ–π

### 2. **–ö–Ω–æ–ø–∫–∞ "üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ":**
- –î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∏–≥—Ä–∞ –≤ –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑–µ
- –°–æ–∑–¥–∞–µ—Ç mock –æ–±—ä–µ–∫—Ç `update`
- –í—ã–∑—ã–≤–∞–µ—Ç `start_voting_phase` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –∏–≥—Ä—É –≤ —Ñ–∞–∑—É –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è

### 3. **–ö–Ω–æ–ø–∫–∞ "üê∫ –í—ã–±—Ä–∞—Ç—å –≤–æ–ª–∫–∞":**
- –î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∏–≥—Ä–∞ –≤ –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑–µ
- –°–æ–∑–¥–∞–µ—Ç mock –æ–±—ä–µ–∫—Ç `update`
- –í—ã–∑—ã–≤–∞–µ—Ç `start_wolf_voting_phase` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ù–∞—á–∏–Ω–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ "–ö—Ç–æ –≤–æ–ª–∫?"

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Mock –æ–±—ä–µ–∫—Ç `update` (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π):
```python
mock_update = type('MockUpdate', (), {
    'message': type('MockMessage', (), {
        'reply_text': lambda self, text, **kwargs: context.bot.send_message(
            chat_id=game.chat_id, 
            text=text, 
            message_thread_id=game.thread_id
        )
    })()
})()
```

**–≠—Ç–æ—Ç mock –æ–±—ä–µ–∫—Ç:**
- –ò–º–∏—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É `Update` –æ–±—ä–µ–∫—Ç–∞
- –°–æ–¥–µ—Ä–∂–∏—Ç `message` —Å –º–µ—Ç–æ–¥–æ–º `reply_text`
- `reply_text` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `context.bot.send_message`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `message_thread_id` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–º–∞–º–∏

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–¢–µ—Å—Ç –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ: 19/19 —Ç–µ—Å—Ç–æ–≤ (100% —É—Å–ø–µ—Ö–∞)**

### ‚úÖ –ü—Ä–æ–π–¥–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑—ã
- –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏ –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–æ–≤
- –ü–æ—Ç–æ–∫ –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑—ã
- –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ mock –æ–±—ä–µ–∫—Ç–æ–≤
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π mock –æ–±—ä–µ–∫—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç:
- **Mock reply_text —Ä–∞–±–æ—Ç–∞–µ—Ç** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `self`

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ö–Ω–æ–ø–∫–∞ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –¥–Ω–µ–º —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!**

### ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
- –ö–Ω–æ–ø–∫–∞ "üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ" —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ö–Ω–æ–ø–∫–∞ "üê∫ –í—ã–±—Ä–∞—Ç—å –≤–æ–ª–∫–∞" —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –º–µ—Ç–æ–¥—ã
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Ñ–∞–∑–∞–º–∏ –∏–≥—Ä—ã
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### üéÆ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
1. **–ù–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É** –∫–æ–º–∞–Ω–¥–æ–π `/start_game`
2. **–î–æ–∂–¥–∏—Ç–µ—Å—å –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑—ã** (–ø–æ—Å–ª–µ –Ω–æ—á–Ω–æ–π —Ñ–∞–∑—ã)
3. **–ù–∞–∂–º–∏—Ç–µ "üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Å—É–∂–¥–µ–Ω–∏–µ"** –¥–ª—è –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—é
4. **–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "üê∫ –í—ã–±—Ä–∞—Ç—å –≤–æ–ª–∫–∞"** –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è "–ö—Ç–æ –≤–æ–ª–∫?"

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç —Ç–µ–ø–µ—Ä—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–Ω–µ–≤–Ω–æ–π —Ñ–∞–∑–æ–π –∏–≥—Ä—ã!** üéâ

---
*–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è*
