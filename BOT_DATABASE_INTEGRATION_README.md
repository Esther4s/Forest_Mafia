# ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –õ–µ—Å –∏ –≤–æ–ª–∫–∏ Bot

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±–æ—Ç–∞ –õ–µ—Å –∏ –≤–æ–ª–∫–∏. –¢–µ–ø–µ—Ä—å –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å PostgreSQL —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å `database_psycopg2.py` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏–≥—Ä –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞

### 2. **–ö–æ–º–∞–Ω–¥–∞ /start**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `users` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- –û–±–Ω–æ–≤–ª—è–µ—Ç username, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ë–∞–ª–∞–Ω—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0 –æ—Ä–µ—à–∫–æ–≤

### 3. **–ö–æ–º–∞–Ω–¥–∞ /–±–∞–ª–∞–Ω—Å**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`
- –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç –≤ –ë–î
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Å —ç–º–æ–¥–∑–∏

### 4. **–ö–æ–º–∞–Ω–¥–∞ /–∏–≥—Ä–∞**
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `user_games` –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç ID —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∏–≥—Ä—ã –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
- –¢–∏–ø –∏–≥—Ä—ã: "forest_mafia"

### 5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**
- –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `stats`
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è `games_played` –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è `games_won` –∏–ª–∏ `games_lost` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `last_played` —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º

## üöÄ –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

### `/start`
```
üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –õ–µ—Å –∏ –≤–æ–ª–∫–∏ Bot!

–°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ –∏–≥—Ä—É.
```

### `/–±–∞–ª–∞–Ω—Å`
```
üå∞ –ë–∞–ª–∞–Ω—Å –∏–≥—Ä–æ–∫–∞ username:

üí≥ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: 0.00 –æ—Ä–µ—à–∫–æ–≤

üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /–∏–≥—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã!
```

### `/–∏–≥—Ä–∞`
```
üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞!

üÜî ID –∏–≥—Ä—ã: 123
üë§ –ò–≥—Ä–æ–∫: username
üéØ –¢–∏–ø –∏–≥—Ä—ã: Forest Mafia
üìÖ –°–æ–∑–¥–∞–Ω–∞: 15.01.2024 14:30

üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –∏–≥—Ä—É!
```

## üóÑÔ∏è –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users`
- **–°–æ–∑–¥–∞–Ω–∏–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ `/start` –∏–ª–∏ `/–±–∞–ª–∞–Ω—Å`
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: username –ø—Ä–∏ –∫–∞–∂–¥–æ–º `/start`
- **–ü–æ–ª—è**: id, user_id, username, balance, created_at, updated_at

### –¢–∞–±–ª–∏—Ü–∞ `user_games`
- **–°–æ–∑–¥–∞–Ω–∏–µ**: –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–µ `/–∏–≥—Ä–∞`
- **–ü–æ–ª—è**: id, user_id, game_type, status, created_at, updated_at

### –¢–∞–±–ª–∏—Ü–∞ `stats`
- **–°–æ–∑–¥–∞–Ω–∏–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∏–≥—Ä–µ
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã
- **–ü–æ–ª—è**: id, user_id, games_played, games_won, games_lost, last_played

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–º–ø–æ—Ä—Ç—ã
```python
from database_psycopg2 import (
    init_db, close_db,
    create_user, get_user_by_telegram_id, update_user_balance,
    execute_query, fetch_one
)
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
```python
def __init__(self):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    try:
        self.db = init_db()
        logger.info("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: {e}")
        self.db = None
```

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
```python
application.add_handler(CommandHandler("–±–∞–ª–∞–Ω—Å", self.balance_command))
application.add_handler(CommandHandler("–∏–≥—Ä–∞", self.game_command))
```

### –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
```python
try:
    application.run_polling()
except KeyboardInterrupt:
    logger.info("‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞...")
finally:
    if self.db:
        close_db()
        logger.info("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–æ")
```

## üìä –õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –ü—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –∏–≥—Ä—ã:
1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π**: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞**:
   - `games_played += 1`
   - –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –∏–≥—Ä–æ–∫–∞ = –∫–æ–º–∞–Ω–¥–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è: `games_won += 1`
   - –ò–Ω–∞—á–µ: `games_lost += 1`
   - `last_played = CURRENT_TIMESTAMP`

### –ü—Ä–∏–º–µ—Ä SQL –∑–∞–ø—Ä–æ—Å–æ–≤:
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO users (user_id, username) VALUES (123456, 'username')
ON CONFLICT (user_id) DO UPDATE SET username = EXCLUDED.username;

-- –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã
INSERT INTO user_games (user_id, game_type, status) 
VALUES (123456, 'forest_mafia', 'created');

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
UPDATE stats 
SET games_played = games_played + 1, 
    games_won = games_won + 1,
    last_played = CURRENT_TIMESTAMP
WHERE user_id = 123456;
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î
```python
if not self.db:
    await update.message.reply_text("‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
    return
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
```python
try:
    # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î
except Exception as e:
    logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î: {e}")
    await update.message.reply_text("‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```python
# –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ
# ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ
```

## üìù –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
DATABASE_URL=postgresql://user:password@host:port/database
BOT_TOKEN=your_bot_token
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
pip install psycopg2-binary python-dotenv
```

### –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç `complete_database_schema.sql` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü.

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `users` —Å –±–∞–ª–∞–Ω—Å–æ–º 0
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/–±–∞–ª–∞–Ω—Å` - –≤–∏–¥–∏—Ç –±–∞–ª–∞–Ω—Å 0
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/–∏–≥—Ä–∞` - —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–≥—Ä–∞
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–≥—Ä–∞–µ—Ç –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç
6. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: games_played=1, games_won=1

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`
2. Username –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ë–î
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/–±–∞–ª–∞–Ω—Å` - –≤–∏–¥–∏—Ç —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–≥—Ä–∞–µ—Ç –∏ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç
5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: games_played+=1, games_lost+=1

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ë–æ—Ç —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –±–∞–ª–∞–Ω—Å—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–≥—Ä—ã
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
- ‚úÖ –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å `database_psycopg2.py` –∫–∞–∫ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å!
