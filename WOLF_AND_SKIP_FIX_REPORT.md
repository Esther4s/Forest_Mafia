# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ "–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞" –¥–ª—è –≤–æ–ª–∫–∞ –∏ –ø—Ä–æ–ø—É—Å–∫–∞ –Ω–æ—á–∏

## üêõ –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤–æ–ª–∫–∞ –≤—ã–±—Ä–∞—Ç—å —Ü–µ–ª—å –¥–ª—è –∞—Ç–∞–∫–∏ –∏–ª–∏ –ø—Ä–∏ –ø—Ä–æ–ø—É—Å–∫–µ –Ω–æ—á–∏ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ "–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞".

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã
–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –º–µ—Ç–æ–¥–µ `_find_user_game` –≤ —Ñ–∞–π–ª–µ `callback_handler.py`. –ú–µ—Ç–æ–¥ –∏—Å–∫–∞–ª –∏–≥—Ä—É —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `bot_instance.player_games`, –Ω–æ –∏–≥—Ä–æ–∫–∏ –º–æ–≥–ª–∏ –±—ã—Ç—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —ç—Ç–æ–º —Å–ª–æ–≤–∞—Ä–µ, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –≤–æ–∑–≤—Ä–∞—Ç—É `None` –∏ –æ—à–∏–±–∫–µ "–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞".

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `_find_user_game` –≤ `callback_handler.py`
**–§–∞–π–ª**: `callback_handler.py` (—Å—Ç—Ä–æ–∫–∏ 459-485)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥ –∏—Å–∫–∞–ª –∏–≥—Ä—É —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `player_games`, –Ω–æ –∏–≥—Ä–æ–∫–∏ –º–æ–≥–ª–∏ –±—ã—Ç—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ç–∞–º.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω fallback –º–µ—Ö–∞–Ω–∏–∑–º - –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ `player_games`, –º–µ—Ç–æ–¥ —Ç–µ–ø–µ—Ä—å –∏—â–µ—Ç –ø–æ –≤—Å–µ–º –∏–≥—Ä–∞–º:

```python
def _find_user_game(self, user_id: int) -> Optional[Game]:
    """–ù–∞—Ö–æ–¥–∏—Ç –∏–≥—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    try:
        # –ü–æ–ª—É—á–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞
        from bot import ForestWolvesBot
        bot_instance = ForestWolvesBot.get_instance()
        
        if not bot_instance:
            return None
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—á–∞—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –∏–≥—Ä–µ
        if user_id not in bot_instance.player_games:
            # –ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ player_games, –∏—â–µ–º –ø–æ –≤—Å–µ–º –∏–≥—Ä–∞–º
            for game in bot_instance.games.values():
                if user_id in game.players:
                    return game
            return None
        
        # –ü–æ–ª—É—á–∞–µ–º chat_id –∏–≥—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        chat_id = bot_instance.player_games[user_id]
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–≥—Ä—É, –µ—Å–ª–∏ –æ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        return bot_instance.games.get(chat_id)
        
    except Exception as e:
        self.logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}: {e}")
        return None
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `handle_night_skip_callback` –≤ `bot.py`
**–§–∞–π–ª**: `bot.py` (—Å—Ç—Ä–æ–∫–∏ 3515-3550)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `self.player_games` –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–≥—Ä—ã, –Ω–æ –∏–≥—Ä–æ–∫–∏ –º–æ–≥–ª–∏ –±—ã—Ç—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã —Ç–∞–º.

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–µ–Ω –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ `player_games` –Ω–∞ –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –∏–≥—Ä–∞–º:

```python
# –ò—â–µ–º –∏–≥—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
game = None
for chat_id, g in self.games.items():
    if user_id in g.players:
        game = g
        break

if game:
    if game.chat_id in self.night_actions:
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–ø—É—Å–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∑–∞–π—Ü–∞
        success = self.night_actions[game.chat_id].skip_action(user_id)
        if success:
            await query.edit_message_text("üò¥ –í—ã –∑–∞—Å–Ω—É–ª–∏ –∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ –Ω–æ—á—å")
        else:
            await query.answer("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥!", show_alert=True)
    else:
        await query.edit_message_text("‚ùå –ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!")
else:
    await query.answer("‚ùå –í—ã –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ –∏–≥—Ä–µ!", show_alert=True)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã:
- ‚úÖ **–ò–º–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª–µ–π**: –í—Å–µ –º–æ–¥—É–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã**: –ò–≥—Ä–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–ù–∞—á–∞–ª–æ –∏–≥—Ä—ã –∏ —Ä–æ–ª–∏**: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–ù–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è**: –°–∏—Å—Ç–µ–º–∞ –Ω–æ—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è**: –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: 6/6 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ ‚úÖ

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"** –ø—Ä–∏ –¥–µ–π—Å—Ç–≤–∏—è—Ö –≤–æ–ª–∫–∞
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"** –ø—Ä–∏ –ø—Ä–æ–ø—É—Å–∫–µ –Ω–æ—á–∏
- ‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** –ø–æ–∏—Å–∫–∞ –∏–≥—Ä –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞** –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–û—à–∏–±–∫–∞ –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—É—Ç–µ–º —É–ª—É—á—à–µ–Ω–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–æ–∏—Å–∫–∞ –∏–≥—Ä –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤. –¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –∏–≥—Ä—É –∏–≥—Ä–æ–∫–∞ –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `player_games`, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞.
