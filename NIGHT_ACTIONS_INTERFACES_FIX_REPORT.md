# üåô –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ night_interfaces

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–í–æ–ª–∫ –Ω–µ –ø–æ–ª—É—á–∞–ª –∫–Ω–æ–ø–∫–∏ –Ω–æ—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, –ø–æ—Ç–æ–º—É —á—Ç–æ `night_interfaces` –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –≤ –º–µ—Ç–æ–¥–µ `start_night_phase`.

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### **–ü—Ä–æ–±–ª–µ–º–∞ –≤ bot.py**
- **–ú–µ—Ç–æ–¥**: `start_night_phase`
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ —Å–æ–∑–¥–∞–Ω–∏–µ `night_interfaces` –¥–ª—è –∏–≥—Ä—ã
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ `night_actions` –∏ `night_interfaces` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –Ω–æ—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

### **–ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# –°–æ–∑–¥–∞–µ–º night_actions –∏ night_interfaces –¥–ª—è –∏–≥—Ä—ã
if game.chat_id not in self.night_actions:
    self.night_actions[game.chat_id] = NightActions(game)
if game.chat_id not in self.night_interfaces:
    self.night_interfaces[game.chat_id] = NightInterface(game, self.night_actions[game.chat_id], self.get_display_name)
```

## üìã –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã

### **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
1. –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–ª–∞ –Ω–æ—á–Ω—É—é —Ñ–∞–∑—É
2. –í—ã–∑—ã–≤–∞–ª—Å—è `send_night_actions_to_players`
3. –ü—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –Ω–∞–ª–∏—á–∏–µ `night_interfaces[chat_id]`
4. **–ü–†–û–ë–õ–ï–ú–ê**: `night_interfaces` –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è, –ø–æ—ç—Ç–æ–º—É —É—Å–ª–æ–≤–∏–µ `if chat_id in self.night_interfaces:` –≤–æ–∑–≤—Ä–∞—â–∞–ª–æ `False`
5. –ù–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –∏–≥—Ä–æ–∫–∞–º

### **–ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ `night_actions` –¥–ª—è –∏–≥—Ä—ã
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ `night_interfaces` –¥–ª—è –∏–≥—Ä—ã
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
4. ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test_night_actions_fix.py`:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ `NightActions`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ `NightInterface`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤–æ–ª–∫ –ø–æ–ª—É—á–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∑–∞—è—Ü –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

### üéâ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!**
- ‚úÖ `night_interfaces` —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã
- ‚úÖ –í–æ–ª–∫ –ø–æ–ª—É—á–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –Ω–æ—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ –í—Å–µ —Ä–æ–ª–∏ —Å –Ω–æ—á–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ö–Ω–æ–ø–∫–∏ –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ callback_data

### üöÄ **–¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- **–í–æ–ª–∫**: –ø–æ–ª—É—á–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ "–£–±–∏—Ç—å {—Ü–µ–ª—å}" –∏ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥"
- **–õ–∏—Å–∞**: –ø–æ–ª—É—á–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ "–û–±–æ–∫—Ä–∞—Å—Ç—å {—Ü–µ–ª—å}" –∏ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥"
- **–ë–æ–±—ë—Ä**: –ø–æ–ª—É—á–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ "–ü–æ–º–æ—á—å {—Ü–µ–ª—å}" –∏ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥"
- **–ö—Ä–æ—Ç**: –ø–æ–ª—É—á–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å {—Ü–µ–ª—å}" –∏ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ö–æ–¥"

## üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

### **–í –º–µ—Ç–æ–¥–µ `start_night_phase`:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è `night_actions` –¥–ª—è –∏–≥—Ä—ã
2. –°–æ–∑–¥–∞–µ—Ç—Å—è `night_interface` –¥–ª—è –∏–≥—Ä—ã
3. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `send_night_actions_to_players`
4. `send_night_actions_to_players` –Ω–∞—Ö–æ–¥–∏—Ç `night_interfaces[chat_id]`
5. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `send_role_reminders`
6. `send_role_reminders` –≤—ã–∑—ã–≤–∞–µ—Ç `send_night_actions_menu` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
7. –ò–≥—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–Ω–æ–ø–∫–∏ –Ω–æ—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

## üéØ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—ã–ª–æ –ø—Ä–æ—Å—Ç—ã–º, –Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–º. –ü—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–ª–∞—Å—å –≤ —Ç–æ–º, —á—Ç–æ `night_interfaces` –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç, –∏–∑-–∑–∞ —á–µ–≥–æ –Ω–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –∏–≥—Ä–æ–∫–∞–º.

–¢–µ–ø–µ—Ä—å –≤–æ–ª–∫ –∏ –≤—Å–µ –¥—Ä—É–≥–∏–µ —Ä–æ–ª–∏ —Å –Ω–æ—á–Ω—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –ø–æ–ª—É—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∏ –º–æ–≥—É—Ç —Å–æ–≤–µ—Ä—à–∞—Ç—å —Å–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–æ—á—å—é!

---
*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ night_interfaces –≤ start_night_phase*
